<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TYPESTRIKE â€” Neon Typing Arena</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:        #080c14;
  --bg2:       #0d1420;
  --panel:     #111827;
  --border:    #1e2d45;
  --cyan:      #00f5ff;
  --pink:      #ff2d78;
  --yellow:    #ffe600;
  --green:     #00ff88;
  --red:       #ff4444;
  --purple:    #b44dff;
  --text:      #c8d8f0;
  --dim:       #4a5a70;
  --font-game: 'Share Tech Mono', monospace;
  --font-ui:   'Press Start 2P', monospace;
}

html, body {
  width: 100%; height: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-game);
  overflow: hidden;
}

/* scanline overlay */
body::before {
  content: '';
  position: fixed; inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.08) 2px,
    rgba(0,0,0,0.08) 4px
  );
  pointer-events: none;
  z-index: 9999;
}

/* animated grid bg */
body::after {
  content: '';
  position: fixed; inset: 0;
  background-image:
    linear-gradient(rgba(0,245,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,245,255,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
  animation: gridDrift 20s linear infinite;
  pointer-events: none;
  z-index: 0;
}
@keyframes gridDrift {
  from { background-position: 0 0; }
  to   { background-position: 40px 40px; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen {
  position: fixed; inset: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  z-index: 10;
  opacity: 0; pointer-events: none;
  transition: opacity 0.35s ease;
}
.screen.active { opacity: 1; pointer-events: all; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MENU SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#menu-screen {
  gap: 48px;
}

.logo {
  font-family: var(--font-ui);
  font-size: clamp(20px, 4vw, 38px);
  color: var(--cyan);
  text-shadow:
    0 0 10px var(--cyan),
    0 0 30px var(--cyan),
    0 0 60px rgba(0,245,255,0.4);
  letter-spacing: 6px;
  text-align: center;
  animation: logoPulse 3s ease-in-out infinite;
}
.logo span { color: var(--pink); text-shadow: 0 0 10px var(--pink), 0 0 30px var(--pink); }
@keyframes logoPulse {
  0%,100% { opacity: 1; }
  50%      { opacity: 0.85; }
}

.tagline {
  font-size: 13px;
  color: var(--dim);
  letter-spacing: 4px;
  text-align: center;
  margin-top: -36px;
}

.mode-cards {
  display: flex; gap: 24px; flex-wrap: wrap; justify-content: center;
}

.mode-card {
  width: 200px;
  padding: 28px 20px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 4px;
  cursor: pointer;
  text-align: center;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}
.mode-card::before {
  content: '';
  position: absolute; inset: 0;
  opacity: 0;
  transition: opacity 0.2s;
}
.mode-card:hover::before { opacity: 1; }
.mode-card:hover { transform: translateY(-6px); }

.mode-card[data-mode="solo"]   { --card-c: var(--cyan); }
.mode-card[data-mode="ai"]     { --card-c: var(--purple); }
.mode-card[data-mode="player"] { --card-c: var(--pink); }

.mode-card::before { background: radial-gradient(circle at 50% 0%, rgba(255,255,255,0.04), transparent 70%); }
.mode-card { border-color: var(--card-c); box-shadow: 0 0 0 rgba(0,0,0,0); }
.mode-card:hover { box-shadow: 0 0 24px color-mix(in srgb, var(--card-c) 50%, transparent), 0 8px 32px rgba(0,0,0,0.5); }

.card-icon {
  font-size: 36px;
  margin-bottom: 16px;
  display: block;
}

.card-title {
  font-family: var(--font-ui);
  font-size: 9px;
  color: var(--card-c);
  letter-spacing: 2px;
  margin-bottom: 10px;
  text-shadow: 0 0 8px var(--card-c);
}

.card-desc {
  font-size: 12px;
  color: var(--dim);
  line-height: 1.6;
}

/* AI difficulty selector */
.ai-difficulty {
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}
.ai-difficulty.visible { display: flex; }
.ai-difficulty label {
  font-family: var(--font-ui);
  font-size: 8px;
  color: var(--purple);
  letter-spacing: 2px;
}
.diff-btns { display: flex; gap: 10px; }
.diff-btn {
  padding: 8px 16px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 3px;
  color: var(--dim);
  font-family: var(--font-game);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.15s;
}
.diff-btn.selected, .diff-btn:hover {
  border-color: var(--purple);
  color: var(--purple);
  box-shadow: 0 0 10px rgba(180,77,255,0.3);
}

.btn-start {
  font-family: var(--font-ui);
  font-size: 10px;
  padding: 16px 40px;
  background: transparent;
  border: 2px solid var(--cyan);
  color: var(--cyan);
  letter-spacing: 3px;
  cursor: pointer;
  border-radius: 3px;
  text-shadow: 0 0 8px var(--cyan);
  box-shadow: 0 0 16px rgba(0,245,255,0.2);
  transition: all 0.2s;
  display: none;
}
.btn-start.visible { display: block; }
.btn-start:hover {
  background: rgba(0,245,255,0.08);
  box-shadow: 0 0 32px rgba(0,245,255,0.4);
  transform: scale(1.03);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game-screen {
  padding: 24px;
  gap: 0;
  justify-content: flex-start;
}

.game-header {
  width: 100%; max-width: 900px;
  display: flex; align-items: center; justify-content: space-between;
  padding: 16px 0 24px;
}

.game-title {
  font-family: var(--font-ui);
  font-size: 8px;
  color: var(--dim);
  letter-spacing: 3px;
}

/* Timer */
.timer-wrap {
  display: flex; flex-direction: column; align-items: center; gap: 6px;
}
.timer-ring {
  position: relative; width: 70px; height: 70px;
}
.timer-ring svg { transform: rotate(-90deg); }
.timer-ring circle.bg { fill: none; stroke: var(--border); stroke-width: 4; }
.timer-ring circle.fg {
  fill: none;
  stroke: var(--cyan);
  stroke-width: 4;
  stroke-linecap: round;
  stroke-dasharray: 188.5;
  stroke-dashoffset: 0;
  transition: stroke-dashoffset 1s linear, stroke 0.5s;
}
.timer-ring circle.fg.urgent { stroke: var(--red); }
.timer-label {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-ui);
  font-size: 14px;
  color: var(--cyan);
}
.timer-label.urgent { color: var(--red); animation: blink 0.5s step-end infinite; }
@keyframes blink { 50% { opacity: 0.3; } }

/* HUD stats */
.hud {
  display: flex; gap: 24px;
}
.hud-stat {
  text-align: center;
}
.hud-val {
  font-family: var(--font-ui);
  font-size: 18px;
  color: var(--yellow);
  text-shadow: 0 0 10px var(--yellow);
}
.hud-key {
  font-size: 10px;
  color: var(--dim);
  letter-spacing: 2px;
  margin-top: 3px;
}

/* VS strip (AI / Player mode) */
.vs-strip {
  width: 100%; max-width: 900px;
  display: none; gap: 16px; margin-bottom: 16px;
}
.vs-strip.visible { display: flex; }
.vs-bar {
  flex: 1;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 10px 14px;
  display: flex; align-items: center; justify-content: space-between;
}
.vs-bar .bar-name { font-size: 12px; color: var(--dim); }
.vs-bar .bar-score {
  font-family: var(--font-ui);
  font-size: 14px;
}
.vs-bar.p1 { border-color: var(--cyan); }
.vs-bar.p1 .bar-score { color: var(--cyan); text-shadow: 0 0 8px var(--cyan); }
.vs-bar.p2 { border-color: var(--pink); }
.vs-bar.p2 .bar-score { color: var(--pink); text-shadow: 0 0 8px var(--pink); }

/* Word display */
.words-panel {
  width: 100%; max-width: 900px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 28px 32px;
  margin-bottom: 20px;
  min-height: 120px;
  position: relative;
  overflow: hidden;
}
.words-panel::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg, var(--cyan), var(--purple), var(--pink));
  animation: scanH 3s linear infinite;
}
@keyframes scanH {
  from { background-position: -900px 0; }
  to   { background-position: 900px 0; }
}

#word-display {
  display: flex; flex-wrap: wrap; gap: 10px 18px;
  font-size: 22px;
  line-height: 1.8;
  user-select: none;
}

.word-token {
  transition: color 0.1s, text-shadow 0.1s;
  color: var(--dim);
}
.word-token.done-correct {
  color: var(--green);
}
.word-token.done-wrong {
  color: var(--red);
  text-decoration: line-through;
}
.word-token.current {
  color: #fff;
  text-shadow: 0 0 12px rgba(255,255,255,0.5);
  border-bottom: 2px solid var(--cyan);
}

/* Input area */
.input-wrap {
  width: 100%; max-width: 900px;
  position: relative;
}
#type-input {
  width: 100%;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 18px 24px;
  font-family: var(--font-game);
  font-size: 22px;
  color: #fff;
  outline: none;
  caret-color: var(--cyan);
  transition: border-color 0.2s, box-shadow 0.2s;
}
#type-input:focus {
  border-color: var(--cyan);
  box-shadow: 0 0 0 2px rgba(0,245,255,0.12), 0 0 24px rgba(0,245,255,0.08);
}
#type-input.error {
  border-color: var(--red);
  box-shadow: 0 0 0 2px rgba(255,68,68,0.2);
  animation: shake 0.25s ease;
}
@keyframes shake {
  0%,100% { transform: translateX(0); }
  25%      { transform: translateX(-6px); }
  75%      { transform: translateX(6px); }
}

.input-hint {
  position: absolute; right: 16px; top: 50%;
  transform: translateY(-50%);
  font-size: 11px; color: var(--dim); letter-spacing: 2px;
}

/* AI typing indicator */
.ai-status {
  width: 100%; max-width: 900px;
  display: none; align-items: center; gap: 12px;
  margin-top: 12px;
  font-size: 12px; color: var(--purple);
}
.ai-status.visible { display: flex; }
.ai-dots span {
  display: inline-block; width: 6px; height: 6px;
  background: var(--purple); border-radius: 50%;
  animation: dotBounce 1.2s infinite;
}
.ai-dots span:nth-child(2) { animation-delay: 0.2s; }
.ai-dots span:nth-child(3) { animation-delay: 0.4s; }
@keyframes dotBounce {
  0%,80%,100% { transform: translateY(0); opacity: 0.4; }
  40%          { transform: translateY(-5px); opacity: 1; }
}

/* Player 2 waiting banner */
#p2-banner {
  position: absolute; inset: 0;
  background: rgba(8,12,20,0.95);
  display: none; flex-direction: column;
  align-items: center; justify-content: center; gap: 20px;
  z-index: 50;
  border-radius: 4px;
}
#p2-banner.visible { display: flex; }
#p2-banner h2 {
  font-family: var(--font-ui);
  font-size: 11px;
  color: var(--pink);
  text-shadow: 0 0 12px var(--pink);
  letter-spacing: 3px;
}
#p2-banner p { font-size: 14px; color: var(--dim); }
.btn-p2ready {
  font-family: var(--font-ui);
  font-size: 9px;
  padding: 14px 28px;
  background: transparent;
  border: 2px solid var(--pink);
  color: var(--pink);
  cursor: pointer;
  border-radius: 3px;
  letter-spacing: 2px;
  transition: all 0.2s;
}
.btn-p2ready:hover {
  background: rgba(255,45,120,0.1);
  box-shadow: 0 0 20px rgba(255,45,120,0.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULTS SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#result-screen { gap: 32px; }

.result-title {
  font-family: var(--font-ui);
  font-size: clamp(12px, 3vw, 22px);
  text-align: center;
  letter-spacing: 4px;
}
.result-title.win  { color: var(--yellow); text-shadow: 0 0 20px var(--yellow), 0 0 50px var(--yellow); animation: winPulse 1.5s ease-in-out infinite; }
.result-title.tie  { color: var(--cyan);   text-shadow: 0 0 20px var(--cyan); }
.result-title.lose { color: var(--red);    text-shadow: 0 0 20px var(--red); }
@keyframes winPulse { 0%,100% { letter-spacing:4px; } 50% { letter-spacing:8px; } }

.result-cards {
  display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;
}
.result-card {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 28px 36px;
  text-align: center;
  min-width: 180px;
}
.result-card.highlight-p1 { border-color: var(--cyan); box-shadow: 0 0 20px rgba(0,245,255,0.2); }
.result-card.highlight-p2 { border-color: var(--pink); box-shadow: 0 0 20px rgba(255,45,120,0.2); }

.rc-name {
  font-family: var(--font-ui);
  font-size: 8px;
  letter-spacing: 2px;
  margin-bottom: 18px;
}
.rc-name.cyan  { color: var(--cyan); }
.rc-name.pink  { color: var(--pink); }
.rc-name.purple{ color: var(--purple); }

.rc-stat { margin-bottom: 12px; }
.rc-val {
  font-family: var(--font-ui);
  font-size: 26px;
  color: var(--yellow);
  text-shadow: 0 0 10px var(--yellow);
}
.rc-label { font-size: 11px; color: var(--dim); letter-spacing: 2px; margin-top: 4px; }

.result-btns { display: flex; gap: 16px; }
.btn-ghost {
  font-family: var(--font-ui);
  font-size: 8px;
  padding: 14px 24px;
  background: transparent;
  border: 1px solid var(--border);
  color: var(--dim);
  cursor: pointer;
  border-radius: 3px;
  letter-spacing: 2px;
  transition: all 0.2s;
}
.btn-ghost:hover { border-color: var(--cyan); color: var(--cyan); box-shadow: 0 0 12px rgba(0,245,255,0.2); }

/* Confetti canvas */
#confetti { position: fixed; inset: 0; pointer-events: none; z-index: 100; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYER 2 TURN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#p2turn-screen { gap: 28px; }
.p2turn-title {
  font-family: var(--font-ui);
  font-size: clamp(10px, 2.5vw, 18px);
  color: var(--pink);
  text-shadow: 0 0 16px var(--pink);
  letter-spacing: 4px;
  text-align: center;
}
.p2turn-sub { font-size: 14px; color: var(--dim); }
.p1-result-preview {
  background: var(--panel);
  border: 1px solid var(--cyan);
  border-radius: 4px;
  padding: 20px 36px;
  text-align: center;
}
.p1-result-preview .label { font-size: 11px; color: var(--dim); margin-bottom: 8px; }
.p1-result-preview .score {
  font-family: var(--font-ui);
  font-size: 28px;
  color: var(--cyan);
  text-shadow: 0 0 12px var(--cyan);
}
.btn-p2start {
  font-family: var(--font-ui);
  font-size: 9px;
  padding: 16px 32px;
  background: transparent;
  border: 2px solid var(--pink);
  color: var(--pink);
  cursor: pointer;
  border-radius: 3px;
  letter-spacing: 2px;
  transition: all 0.2s;
}
.btn-p2start:hover { background: rgba(255,45,120,0.1); box-shadow: 0 0 24px rgba(255,45,120,0.4); }

</style>
</head>
<body>

<canvas id="confetti"></canvas>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="menu-screen" class="screen active">
  <div class="logo">TYPE<span>STRIKE</span></div>
  <div class="tagline">60 SECONDS. PURE SPEED.</div>

  <div class="mode-cards">
    <div class="mode-card" data-mode="solo" onclick="selectMode('solo')">
      <span class="card-icon">âš¡</span>
      <div class="card-title">SOLO</div>
      <div class="card-desc">Beat the clock.<br>Just you and the words.</div>
    </div>
    <div class="mode-card" data-mode="ai" onclick="selectMode('ai')">
      <span class="card-icon">ğŸ¤–</span>
      <div class="card-title">VS AI</div>
      <div class="card-desc">Challenge an AI opponent. How fast can you type?</div>
    </div>
    <div class="mode-card" data-mode="player" onclick="selectMode('player')">
      <span class="card-icon">âš”ï¸</span>
      <div class="card-title">VS PLAYER</div>
      <div class="card-desc">Hot-seat battle. Pass the keyboard.</div>
    </div>
  </div>

  <div class="ai-difficulty" id="ai-diff">
    <label>AI DIFFICULTY</label>
    <div class="diff-btns">
      <button class="diff-btn selected" data-wpm="35" onclick="setDiff(this,35)">ROOKIE</button>
      <button class="diff-btn" data-wpm="55" onclick="setDiff(this,55)">PRO</button>
      <button class="diff-btn" data-wpm="80" onclick="setDiff(this,80)">ELITE</button>
    </div>
  </div>

  <button class="btn-start" id="btn-start" onclick="startGame()">â–¶ START</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• GAME â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="game-screen" class="screen">
  <div class="game-header">
    <div class="game-title" id="game-mode-label">SOLO MODE</div>

    <div class="timer-wrap">
      <div class="timer-ring">
        <svg width="70" height="70" viewBox="0 0 70 70">
          <circle class="bg" cx="35" cy="35" r="30"/>
          <circle class="fg" id="timer-arc" cx="35" cy="35" r="30"/>
        </svg>
        <div class="timer-label" id="timer-label">60</div>
      </div>
    </div>

    <div class="hud">
      <div class="hud-stat">
        <div class="hud-val" id="hud-words">0</div>
        <div class="hud-key">WORDS</div>
      </div>
      <div class="hud-stat">
        <div class="hud-val" id="hud-wpm">0</div>
        <div class="hud-key">WPM</div>
      </div>
      <div class="hud-stat">
        <div class="hud-val" id="hud-acc">100%</div>
        <div class="hud-key">ACC</div>
      </div>
    </div>
  </div>

  <!-- VS bar -->
  <div class="vs-strip" id="vs-strip">
    <div class="vs-bar p1">
      <span class="bar-name" id="p1-bar-name">YOU</span>
      <span class="bar-score" id="p1-bar-score">0</span>
    </div>
    <div style="display:flex;align-items:center;font-family:var(--font-ui);font-size:10px;color:var(--dim)">VS</div>
    <div class="vs-bar p2">
      <span class="bar-name" id="p2-bar-name">AI</span>
      <span class="bar-score" id="p2-bar-score">0</span>
    </div>
  </div>

  <!-- Word display -->
  <div class="words-panel">
    <div id="word-display"></div>
    <div id="p2-banner">
      <h2>PLAYER 1 DONE!</h2>
      <p id="p1-done-msg">Player 1 scored <strong>0</strong> words</p>
      <button class="btn-p2ready" onclick="startP2Turn()">PLAYER 2 â€” READY? â–¶</button>
    </div>
  </div>

  <!-- Input -->
  <div class="input-wrap">
    <input type="text" id="type-input" placeholder="start typingâ€¦" autocomplete="off" autocorrect="off" spellcheck="false" autocapitalize="off">
    <span class="input-hint">SPACE to submit</span>
  </div>

  <!-- AI typing indicator -->
  <div class="ai-status" id="ai-status">
    <div class="ai-dots"><span></span><span></span><span></span></div>
    <span id="ai-status-text">AI is typingâ€¦</span>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• P2 TURN SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="p2turn-screen" class="screen">
  <div class="p2turn-title">PLAYER 2'S TURN</div>
  <div class="p2turn-sub">Same words. Can you beat Player 1?</div>
  <div class="p1-result-preview">
    <div class="label">PLAYER 1 SCORED</div>
    <div class="score" id="p1-preview-score">0 WORDS</div>
  </div>
  <button class="btn-p2start" onclick="beginP2Round()">I'M READY â–¶</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESULTS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="result-screen" class="screen">
  <div class="result-title" id="result-title">GAME OVER</div>
  <div class="result-cards" id="result-cards"></div>
  <div class="result-btns">
    <button class="btn-ghost" onclick="rematch()">â†º REMATCH</button>
    <button class="btn-ghost" onclick="goMenu()">âŒ‚ MENU</button>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORD BANK (250 words)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const WORDS = [
  "the","be","to","of","and","a","in","that","have","it","for","not","on","with",
  "he","as","you","do","at","this","but","his","by","from","they","we","say","her",
  "she","or","an","will","my","one","all","would","there","their","what","so","up",
  "out","if","about","who","get","which","go","me","when","make","can","like","time",
  "no","just","him","know","take","people","into","year","your","good","some","could",
  "them","see","other","than","then","now","look","only","come","its","over","think",
  "also","back","after","use","two","how","our","work","first","well","way","even",
  "new","want","because","any","these","give","day","most","us","great","between",
  "need","large","often","hand","high","place","hold","turn","help","start","never",
  "next","hard","open","seem","together","power","town","fine","drive","front","teach",
  "week","final","gave","lake","piece","told","knew","pass","since","top","whole",
  "king","space","heard","best","hour","better","true","during","hundred","five",
  "remember","step","early","hold","west","ground","interest","reach","fast","five",
  "several","road","let","above","girl","sometimes","mountain","cut","young","talk",
  "soon","list","song","being","leave","family","body","music","color","stand","sun",
  "questions","fish","area","mark","horse","birds","problem","complete","room","knew",
  "since","ever","piece","told","usually","didn","friends","easy","heard","order",
  "red","door","sure","become","top","ship","across","today","during","short","better",
  "best","however","low","hours","black","products","happened","whole","measure",
  "remember","early","waves","reached","listen","wind","rock","space","covered","fast",
  "several","hold","himself","toward","five","step","morning","passed","vowel","true",
  "hundred","against","pattern","numeral","table","north","slowly","money","map","farm",
  "pulled","draw","voice","power","town","fine","drive","front","teach","week","final"
];

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let mode = null;          // 'solo' | 'ai' | 'player'
let aiWPM = 35;
let gameWords = [];
let currentIdx = 0;
let correctCount = 0;
let wrongCount = 0;
let timeLeft = 60;
let timerInterval = null;
let gameActive = false;

// multiplayer
let p1Score = 0, p2Score = 0;
let p2Turn = false;

// AI
let aiScore = 0;
let aiInterval = null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MENU LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function selectMode(m) {
  mode = m;
  document.querySelectorAll('.mode-card').forEach(c => c.style.opacity = c.dataset.mode === m ? '1' : '0.5');
  document.getElementById('ai-diff').classList.toggle('visible', m === 'ai');
  document.getElementById('btn-start').classList.add('visible');
}

function setDiff(el, wpm) {
  aiWPM = wpm;
  document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startGame() {
  if (!mode) return;
  p1Score = 0; p2Score = 0; aiScore = 0; p2Turn = false;
  gameWords = shuffle(WORDS).slice(0, 120);
  beginRound(false);
  showScreen('game-screen');
}

function beginRound(isP2) {
  p2Turn = isP2;
  currentIdx = 0;
  correctCount = 0;
  wrongCount = 0;
  timeLeft = 60;
  gameActive = false;

  // labels
  const modeLabel = document.getElementById('game-mode-label');
  if (mode === 'solo')   modeLabel.textContent = 'SOLO MODE';
  if (mode === 'ai')     modeLabel.textContent = 'VS AI';
  if (mode === 'player') modeLabel.textContent = isP2 ? 'PLAYER 2 TURN' : 'PLAYER 1 TURN';

  // VS strip
  const vs = document.getElementById('vs-strip');
  if (mode !== 'solo') {
    vs.classList.add('visible');
    document.getElementById('p1-bar-name').textContent = isP2 ? 'P1 (FINAL)' : 'YOU';
    document.getElementById('p2-bar-name').textContent = mode === 'ai' ? 'AI' : 'PLAYER 2';
    document.getElementById('p1-bar-score').textContent = isP2 ? p1Score : '0';
    document.getElementById('p2-bar-score').textContent = '0';
  } else {
    vs.classList.remove('visible');
  }

  // AI status
  document.getElementById('ai-status').classList.toggle('visible', mode === 'ai' && !isP2);

  // render words
  renderWords();
  resetTimer();

  // input
  const inp = document.getElementById('type-input');
  inp.value = '';
  inp.disabled = false;
  inp.placeholder = 'start typingâ€¦';
  inp.focus();

  // Hide p2 banner
  document.getElementById('p2-banner').classList.remove('visible');
}

function renderWords() {
  const disp = document.getElementById('word-display');
  disp.innerHTML = '';
  gameWords.forEach((w, i) => {
    const span = document.createElement('span');
    span.className = 'word-token' + (i === 0 ? ' current' : '');
    span.id = `w-${i}`;
    span.textContent = w;
    disp.appendChild(span);
  });
}

function resetTimer() {
  clearInterval(timerInterval);
  timeLeft = 60;
  updateTimerUI();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INPUT HANDLING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('type-input').addEventListener('input', function() {
  if (!gameActive && this.value.length > 0) {
    startCountdown();
  }
});

document.getElementById('type-input').addEventListener('keydown', function(e) {
  if (e.key === ' ' || e.key === 'Enter') {
    e.preventDefault();
    submitWord(this.value.trim());
  }
});

function submitWord(typed) {
  if (!gameActive || currentIdx >= gameWords.length) return;
  if (!typed) return;

  const inp = document.getElementById('type-input');
  const correct = typed === gameWords[currentIdx];

  // mark token
  const token = document.getElementById(`w-${currentIdx}`);
  token.classList.remove('current');
  if (correct) {
    token.classList.add('done-correct');
    correctCount++;
  } else {
    token.classList.add('done-wrong');
    wrongCount++;
    inp.classList.add('error');
    setTimeout(() => inp.classList.remove('error'), 300);
  }

  currentIdx++;
  if (currentIdx < gameWords.length) {
    document.getElementById(`w-${currentIdx}`).classList.add('current');
    scrollToCurrentWord();
  }

  inp.value = '';
  updateHUD();

  if (mode === 'player' && !p2Turn) {
    document.getElementById('p1-bar-score').textContent = correctCount;
  }
}

function scrollToCurrentWord() {
  const cur = document.getElementById(`w-${currentIdx}`);
  if (cur) cur.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
}

function updateHUD() {
  document.getElementById('hud-words').textContent = correctCount;
  const elapsed = 60 - timeLeft;
  const wpm = elapsed > 0 ? Math.round((correctCount / elapsed) * 60) : 0;
  document.getElementById('hud-wpm').textContent = wpm;
  const total = correctCount + wrongCount;
  const acc = total > 0 ? Math.round((correctCount / total) * 100) : 100;
  document.getElementById('hud-acc').textContent = acc + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startCountdown() {
  if (gameActive) return;
  gameActive = true;

  if (mode === 'ai') startAI();

  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimerUI();
    updateHUD();
    if (timeLeft <= 0) endRound();
  }, 1000);
}

function updateTimerUI() {
  const arc     = document.getElementById('timer-arc');
  const label   = document.getElementById('timer-label');
  const pct     = timeLeft / 60;
  const circ    = 188.5;
  arc.style.strokeDashoffset = circ * (1 - pct);
  label.textContent = timeLeft;

  const urgent = timeLeft <= 10;
  arc.classList.toggle('urgent', urgent);
  label.classList.toggle('urgent', urgent);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI OPPONENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startAI() {
  aiScore = 0;
  // AI types at aiWPM words per minute Â± 15% variance
  const msPerWord = (60 / aiWPM) * 1000;
  let aiIdx = 0;

  aiInterval = setInterval(() => {
    if (!gameActive || aiIdx >= gameWords.length) { clearInterval(aiInterval); return; }
    const variance = 0.7 + Math.random() * 0.6;
    // small chance AI gets word wrong (scales with difficulty)
    const missChance = mode === 'ai' ? (aiWPM <= 35 ? 0.12 : aiWPM <= 55 ? 0.06 : 0.02) : 0;
    if (Math.random() > missChance) aiScore++;
    aiIdx++;
    document.getElementById('p2-bar-score').textContent = aiScore;
    document.getElementById('ai-status-text').textContent = `AI typed ${aiScore} wordsâ€¦`;
  }, msPerWord * (0.85 + Math.random() * 0.3));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROUND END
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function endRound() {
  clearInterval(timerInterval);
  clearInterval(aiInterval);
  gameActive = false;
  document.getElementById('type-input').disabled = true;

  if (mode === 'solo') {
    setTimeout(showResults, 500);
  } else if (mode === 'ai') {
    p1Score = correctCount;
    setTimeout(showResults, 500);
  } else {
    // player vs player
    if (!p2Turn) {
      p1Score = correctCount;
      // show P2 turn screen
      setTimeout(showP2TurnScreen, 600);
    } else {
      p2Score = correctCount;
      setTimeout(showResults, 500);
    }
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYER 2 TURN (player vs player)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showP2TurnScreen() {
  document.getElementById('p1-preview-score').textContent = p1Score + ' WORDS';
  showScreen('p2turn-screen');
}

function beginP2Round() {
  showScreen('game-screen');
  // reset same words
  gameWords = shuffle(WORDS).slice(0, 120); // fresh shuffle for P2
  beginRound(true);
}

function startP2Turn() {
  // unused â€” using p2turn screen instead
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showResults() {
  showScreen('result-screen');

  const elapsed = 60;
  const p1WPM = Math.round((mode === 'player' && p2Turn ? p1Score : correctCount) / 1) ; // already per-minute
  const cardsEl = document.getElementById('result-cards');
  cardsEl.innerHTML = '';

  if (mode === 'solo') {
    const wpm = Math.round((correctCount / 60) * 60);
    const acc  = correctCount + wrongCount > 0
      ? Math.round(correctCount / (correctCount + wrongCount) * 100) : 100;

    document.getElementById('result-title').textContent = 'â€” FINAL SCORE â€”';
    document.getElementById('result-title').className = 'result-title tie';

    cardsEl.innerHTML = `
      <div class="result-card">
        <div class="rc-name cyan">YOUR STATS</div>
        <div class="rc-stat"><div class="rc-val">${correctCount}</div><div class="rc-label">WORDS CORRECT</div></div>
        <div class="rc-stat"><div class="rc-val">${wpm}</div><div class="rc-label">WPM</div></div>
        <div class="rc-stat"><div class="rc-val">${acc}%</div><div class="rc-label">ACCURACY</div></div>
      </div>`;
  } else if (mode === 'ai') {
    const yourScore = correctCount;
    const diff = yourScore - aiScore;
    const titleEl = document.getElementById('result-title');
    if (diff > 0) {
      titleEl.textContent = 'ğŸ† YOU WIN!'; titleEl.className = 'result-title win';
      launchConfetti();
    } else if (diff < 0) {
      titleEl.textContent = 'ğŸ¤– AI WINS'; titleEl.className = 'result-title lose';
    } else {
      titleEl.textContent = 'ğŸ¤ TIE GAME'; titleEl.className = 'result-title tie';
    }

    cardsEl.innerHTML = `
      <div class="result-card highlight-p1">
        <div class="rc-name cyan">YOU</div>
        <div class="rc-stat"><div class="rc-val">${yourScore}</div><div class="rc-label">WORDS</div></div>
      </div>
      <div class="result-card highlight-p2">
        <div class="rc-name pink">AI</div>
        <div class="rc-stat"><div class="rc-val">${aiScore}</div><div class="rc-label">WORDS</div></div>
      </div>`;
  } else {
    // player vs player
    const titleEl = document.getElementById('result-title');
    if (p1Score > p2Score) {
      titleEl.textContent = 'ğŸ† PLAYER 1 WINS!'; titleEl.className = 'result-title win'; launchConfetti();
    } else if (p2Score > p1Score) {
      titleEl.textContent = 'ğŸ† PLAYER 2 WINS!'; titleEl.className = 'result-title win'; launchConfetti();
    } else {
      titleEl.textContent = 'ğŸ¤ TIE GAME'; titleEl.className = 'result-title tie';
    }
    cardsEl.innerHTML = `
      <div class="result-card highlight-p1">
        <div class="rc-name cyan">PLAYER 1</div>
        <div class="rc-stat"><div class="rc-val">${p1Score}</div><div class="rc-label">WORDS</div></div>
      </div>
      <div class="result-card highlight-p2">
        <div class="rc-name pink">PLAYER 2</div>
        <div class="rc-stat"><div class="rc-val">${p2Score}</div><div class="rc-label">WORDS</div></div>
      </div>`;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if (id === 'game-screen') setTimeout(() => document.getElementById('type-input').focus(), 100);
}

function goMenu() {
  clearInterval(timerInterval);
  clearInterval(aiInterval);
  gameActive = false;
  mode = null;
  document.querySelectorAll('.mode-card').forEach(c => c.style.opacity = '1');
  document.getElementById('btn-start').classList.remove('visible');
  document.getElementById('ai-diff').classList.remove('visible');
  showScreen('menu-screen');
}

function rematch() {
  if (!mode) return goMenu();
  startGame();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function launchConfetti() {
  const canvas = document.getElementById('confetti');
  const ctx    = canvas.getContext('2d');
  canvas.width  = innerWidth;
  canvas.height = innerHeight;

  const COLS = ['#00f5ff','#ff2d78','#ffe600','#00ff88','#b44dff','#ffffff'];
  const pieces = Array.from({length: 120}, () => ({
    x: Math.random() * canvas.width,
    y: -20 - Math.random() * 200,
    w: 6 + Math.random() * 8,
    h: 4 + Math.random() * 6,
    r: Math.random() * Math.PI * 2,
    dr: (Math.random() - 0.5) * 0.2,
    vx: (Math.random() - 0.5) * 4,
    vy: 2 + Math.random() * 5,
    col: COLS[Math.floor(Math.random() * COLS.length)],
    alpha: 1,
  }));

  let frame;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    let alive = false;
    pieces.forEach(p => {
      p.x += p.vx; p.y += p.vy; p.r += p.dr; p.vy += 0.08;
      if (p.y > canvas.height + 20) { p.alpha -= 0.02; } else { alive = true; }
      if (p.alpha <= 0) return;
      ctx.save();
      ctx.globalAlpha = Math.max(p.alpha, 0);
      ctx.translate(p.x, p.y); ctx.rotate(p.r);
      ctx.fillStyle = p.col;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    });
    if (alive || pieces.some(p => p.y < canvas.height)) {
      frame = requestAnimationFrame(animate);
    } else {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
  }
  if (frame) cancelAnimationFrame(frame);
  animate();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD SHORTCUT â€” ESC to menu
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') goMenu();
});

window.addEventListener('resize', () => {
  const c = document.getElementById('confetti');
  c.width  = innerWidth;
  c.height = innerHeight;
});
</script>
</body>
</html>